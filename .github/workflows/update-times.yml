name: Update Swim Times

# Runs daily at 9:00 PM PST (Pacific Standard Time)
# 9pm PST = 5am UTC next day
# Note: During PDT (daylight saving), this will run at 10pm PT instead of 9pm

on:
  schedule:
    - cron: '0 5 * * *'  # 9pm PST (10pm PDT) = 5am UTC next day
  workflow_dispatch:  # Allow manual triggering

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Install Playwright browsers
        run: playwright install chromium

      - name: Run update script
        run: python p3.py

      - name: Configure Git
        run: |
          git config user.name 'aruslan'
          git config user.email 'aruslan@users.noreply.github.com'

      - name: Set push remote to use PAT
        run: git remote set-url origin https://aruslan:${GH_PAT}@github.com/aruslan/swim-stats.git
        env:
          GH_PAT: ${{ secrets.GH_PAT }}

      - name: Commit and push changes
        run: |
          git add times.json times_metadata.json
          git diff --cached --quiet || git commit -m "Update swim times [auto] - $(date +'%Y-%m-%d %H:%M:%S')"
          git push origin HEAD:main
        env:
          GH_PAT: ${{ secrets.GH_PAT }}